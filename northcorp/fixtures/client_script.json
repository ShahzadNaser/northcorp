[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2021-10-26 20:45:39.881577",
  "name": "Purchase Order-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "$.extend(cur_frm.cscript, new erpnext.buying.PurchaseOrderController({frm: cur_frm}));\n\n\nfrappe.ui.form.on('Purchase Order', {\n    refresh(frm){\n  \t\tfrm.set_query('projects', function () {\n  \t\t    return {\n\t\t\t\tfilters: {\n\t\t\t\t\t\"status\": [\"IN\", [\"Open\", \"Defect Liability Period\"]]\n\t\t\t\t}\n\t\t\t    \n\t\t\t}\n  \t\t});\n    },\n    schedule_date:function(frm,cdt,cdn){\n        var d= locals[cdt][cdn]\n        if(d.tax_category=='UAE VAT 5% Standard'){\n           frm.set_value(\"taxes_and_charges\", \"UAE VAT 5% - NC\");  \n        }\n\n        if(d.tax_category=='RCM \u2013 5% VAT'){\n           frm.set_value(\"taxes_and_charges\", \"RCM \u2013 5% VAT - NC\");\n           frm.set_value(\"reverse_charge\", \"Y\");  \n        }\n\t},\n\tvalidate:function(frm) {\n        $.each(frm.doc.items || [], function(i, v) {\n       frappe.model.set_value(v.doctype, v.name,\"project\",frm.doc.project)\n    });\n\t},\n\tvalidate:function(frm){\n\t   frappe.call({\n                    method: 'frappe.client.get_value',\n                    args: {\n                        'doctype': 'Project',\n                        'filters': {'name': frm.doc.project},\n                        'fieldname': [\n                            'project_manager'\n                        ]\n                    },\n                    callback: function(s) {\n                        if (!s.exc) {\n                           frm.set_value(\"project_manager\", s.message.project_manager);\n                           \n                        }\n                    }\n\t   })\n\t   \n\t},\n\tcost_center:function(frm,cdt,cdn)\n\t{\n\t    var d=locals[cdt][cdn]\n\t    frm.set_value(\"department\",d.cost_center ); \n\t}\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Supplier",
  "enabled": 1,
  "modified": "2021-10-25 21:03:24.380710",
  "name": "Supplier-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Supplier', {\n\trefresh(frm) {\n\t\tfrm.set_query('state', function () {\n  \t\t    return {\n\t\t\t\tfilters: {\n\t\t\t\t\t\"country\": frm.doc.country\n\t\t\t\t}\n\t\t\t    \n\t\t\t}\n  \t\t});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2021-10-26 20:40:13.465691",
  "name": "Project-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project', {\n\trefresh(frm) {\n\t\tif (!frm.is_new()) {\n\t\t    frm.add_custom_button(__('Defect Liability Period'), () => {\n\t\t\t\tfrm.events.set_status(frm, 'Defect Liability Period');\n\t\t\t}, __('Set Status'));\n\t\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Request for Quotation",
  "enabled": 1,
  "modified": "2021-10-30 17:27:51.172882",
  "name": "Request for Quotation-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.ui.form.on(\"Request for Quotation\",{})\n\nerpnext.buying.RequestforQuotationController = erpnext.buying.BuyingController.extend({\n\trefresh: function() {\n\t\tvar me = this;\n\t\tthis._super();\n\t\tif (this.frm.doc.docstatus===0) {\n\t\t\tthis.frm.add_custom_button(__('Material Request'),\n\t\t\t\tfunction() {\n\t\t\t\t\terpnext.utils.map_current_doc({\n\t\t\t\t\t\tmethod: \"erpnext.stock.doctype.material_request.material_request.make_request_for_quotation\",\n\t\t\t\t\t\tsource_doctype: \"Material Request\",\n\t\t\t\t\t\ttarget: me.frm,\n\t\t\t\t\t\tsetters: {\n\t\t\t\t\t\t\tschedule_date: undefined,\n\t\t\t\t\t\t\tstatus: undefined\n\t\t\t\t\t\t},\n\t\t\t\t\t\tget_query_filters: {\n\t\t\t\t\t\t\tmaterial_request_type: \"Purchase\",\n\t\t\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\t\t\tstatus: [\"!=\", \"Stopped\"],\n\t\t\t\t\t\t\tper_ordered: [\"<\", 100],\n\t\t\t\t\t\t\tcompany: me.frm.doc.company\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}, __(\"Get Items From\"));\n\n\t\t\t// Get items from Opportunity\n\t\t\tthis.frm.add_custom_button(__('Opportunity'),\n\t\t\t\tfunction() {\n\t\t\t\t\terpnext.utils.map_current_doc({\n\t\t\t\t\t\tmethod: \"erpnext.crm.doctype.opportunity.opportunity.make_request_for_quotation\",\n\t\t\t\t\t\tsource_doctype: \"Opportunity\",\n\t\t\t\t\t\ttarget: me.frm,\n\t\t\t\t\t\tsetters: {\n\t\t\t\t\t\t\tparty_name: undefined,\n\t\t\t\t\t\t\topportunity_from: undefined,\n\t\t\t\t\t\t\tstatus: undefined\n\t\t\t\t\t\t},\n\t\t\t\t\t\tget_query_filters: {\n\t\t\t\t\t\t\tstatus: [\"not in\", [\"Closed\", \"Lost\"]],\n\t\t\t\t\t\t\tcompany: me.frm.doc.company\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}, __(\"Get Items From\"));\n\n\t\t\t// Get items from open Material Requests based on supplier\n\t\t\tthis.frm.add_custom_button(__('Possible Supplier'), function() {\n\t\t\t\t// Create a dialog window for the user to pick their supplier\n\t\t\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __('Select Possible Supplier'),\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldname: 'supplier',\n\t\t\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\t\t\toptions:'Supplier',\n\t\t\t\t\t\t\tlabel:'Supplier',\n\t\t\t\t\t\t\treqd:1,\n\t\t\t\t\t\t\tdescription: __(\"Get Items from Material Requests against this Supplier\")\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tprimary_action_label: __(\"Get Items\"),\n\t\t\t\t\tprimary_action: (args) => {\n\t\t\t\t\t\tif(!args) return;\n\t\t\t\t\t\tdialog.hide();\n\n\t\t\t\t\t\terpnext.utils.map_current_doc({\n\t\t\t\t\t\t\tmethod: \"erpnext.buying.doctype.request_for_quotation.request_for_quotation.get_item_from_material_requests_based_on_supplier\",\n\t\t\t\t\t\t\tsource_name: args.supplier,\n\t\t\t\t\t\t\ttarget: me.frm,\n\t\t\t\t\t\t\tsetters: {\n\t\t\t\t\t\t\t\tcompany: me.frm.doc.company\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tget_query_filters: {\n\t\t\t\t\t\t\t\tmaterial_request_type: \"Purchase\",\n\t\t\t\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\t\t\t\tstatus: [\"!=\", \"Stopped\"],\n\t\t\t\t\t\t\t\tper_ordered: [\"<\", 100]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdialog.show();\n\t\t\t}, __(\"Get Items From\"));\n\n\t\t\t// Link Material Requests\n\t\t\tthis.frm.add_custom_button(__('Link to Material Requests'),\n\t\t\t\tfunction() {\n\t\t\t\t\terpnext.buying.link_to_mrs(me.frm);\n\t\t\t\t}, __(\"Tools\"));\n\n\t\t\t// Get Suppliers\n\t\t\tthis.frm.add_custom_button(__('Get Suppliers'),\n\t\t\t\tfunction() {\n\t\t\t\t\tme.get_suppliers_button(me.frm);\n\t\t\t\t}, __(\"Tools\"));\n\t\t}\n\t},\n\n\tcalculate_taxes_and_totals: function() {\n\t\treturn;\n\t},\n\n\ttc_name: function() {\n\t\tthis.get_terms();\n\t},\n\n\tget_suppliers_button: function (frm) {\n\t\tvar doc = frm.doc;\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Get Suppliers\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\t\"fieldtype\": \"Select\", \"label\": __(\"Get Suppliers By\"),\n\t\t\t\t\t\"fieldname\": \"search_type\",\n\t\t\t\t\t\"options\": [\"Supplier Group\", \"Tag\"],\n\t\t\t\t\t\"reqd\": 1,\n\t\t\t\t\tonchange() {\n\t\t\t\t\t\tif(dialog.get_value('search_type') == 'Tag'){\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: 'erpnext.buying.doctype.request_for_quotation.request_for_quotation.get_supplier_tag',\n\t\t\t\t\t\t\t}).then(r => {\n\t\t\t\t\t\t\t\tdialog.set_df_property(\"tag\", \"options\", r.message)\n\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"fieldtype\": \"Link\", \"label\": __(\"Supplier Group\"),\n\t\t\t\t\t\"fieldname\": \"supplier_group\",\n\t\t\t\t\t\"options\": \"Supplier Group\",\n\t\t\t\t\t\"reqd\": 0,\n\t\t\t\t\t\"depends_on\": \"eval:doc.search_type == 'Supplier Group'\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"fieldtype\": \"Select\", \"label\": __(\"Tag\"),\n\t\t\t\t\t\"fieldname\": \"tag\",\n\t\t\t\t\t\"reqd\": 0,\n\t\t\t\t\t\"depends_on\": \"eval:doc.search_type == 'Tag'\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"fieldtype\": \"Link\", \"label\": __(\"State\"),\n\t\t\t\t\t\"fieldname\": \"state\",\n\t\t\t\t\t\"options\": \"State\",\n\t\t\t\t\t\"reqd\": 0\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Add Suppliers\"),\n\t\t\tprimary_action : (args) => {\n\t\t\t\tif(!args) return;\n\t\t\t\tdialog.hide();\n\n\t\t\t\t//Remove blanks\n\t\t\t\tfor (var j = 0; j < frm.doc.suppliers.length; j++) {\n\t\t\t\t\tif(!frm.doc.suppliers[j].hasOwnProperty(\"supplier\")) {\n\t\t\t\t\t\tfrm.get_field(\"suppliers\").grid.grid_rows[j].remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction load_suppliers(r) {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\tfor (var i = 0; i < r.message.length; i++) {\n\t\t\t\t\t\t\tvar exists = false;\n\t\t\t\t\t\t\tif (r.message[i].constructor === Array){\n\t\t\t\t\t\t\t\tvar supplier = r.message[i][0];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar supplier = r.message[i].name;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor (var j = 0; j < doc.suppliers.length;j++) {\n\t\t\t\t\t\t\t\tif (supplier === doc.suppliers[j].supplier) {\n\t\t\t\t\t\t\t\t\texists = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(!exists) {\n\t\t\t\t\t\t\t\tvar d = frm.add_child('suppliers');\n\t\t\t\t\t\t\t\td.supplier = supplier;\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(\"supplier\", d.doctype, d.name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfrm.refresh_field(\"suppliers\");\n\t\t\t\t}\n\n\t\t\t\tif (args.search_type === \"Tag\" && args.tag) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.get_tagged_docs\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\"doctype\": \"Supplier\",\n\t\t\t\t\t\t\t\"tag\": args.tag\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: load_suppliers\n\t\t\t\t\t});\n\t\t\t\t} else if (args.supplier_group) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdoctype: \"Supplier\",\n\t\t\t\t\t\t\torder_by: \"name\",\n\t\t\t\t\t\t\tfields: [\"name\"],\n\t\t\t\t\t\t\tfilters: [[\"Supplier\", \"supplier_group\", \"=\", args.supplier_group],[\"Supplier\", \"state\", \"=\", args.state]]\n\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: load_suppliers\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdialog.show();\n\t},\n});\n\n// for backward compatibility: combine new and previous states\n$.extend(cur_frm.cscript, new erpnext.buying.RequestforQuotationController({frm: cur_frm}));\n",
  "view": "Form"
 }
]